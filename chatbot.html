<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ChatBot</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

</head>
<body>
  <div class="container"></div>

  <script type="text/babel">
    function ChatInput({chatMessages,setChatMessages}) {

      const[inputText,setInputText] = React.useState( '');

      function saveInputText(event){
        setInputText(event.target.value);
      }

      function sendMessage(){
        const newChatMessages = [
          ...chatMessages,
          {
              message:inputText,
              sender:'user',
              id :crypto.randomUUID()
            },
          ];
        setChatMessages(newChatMessages);

          const response = Chatbot.getResponse(inputText);

          setChatMessages([
          ...newChatMessages,
          {
              message:response,
              sender:'bot',
              id :crypto.randomUUID()
            },
          ]);


          setInputText('');
      }
      return (
        <>
          <input 
            placeholder="Message with chatbot" 
            size="20"
            onChange={saveInputText}
            value = {inputText}
          />
          <button 
            onClick={sendMessage}
          >Send</button>
        </>
      );
    }

    function ChatMessage({ message, sender }) {
      return (
        <div>
          {sender === 'bot' && <img src="./Bot.webp" width="50" />}
          {message}
          {sender === 'user' && <img src="./Profile.webp" width="50" />}
        </div>
      );
    }

    function ChatMessages({chatMessages}) {
        return (
          <>
            {chatMessages.map((chatMessage) => {
                return (
                  <ChatMessage 
                    message={chatMessage.message}
                    sender={chatMessage.sender}
                    key={chatMessage.id}
                  />
                );
              })}
          </>
        );

    }

    function App() {
      const [chatMessages, setChatMessages] = React.useState([]);
      
      return (
        <>
          <ChatInput 
            chatMessages = {chatMessages}
            setChatMessages = {setChatMessages}
          />
          <ChatMessages 
            chatMessages = {chatMessages}
          />
        </>
      );
    }

    // Mount React App
    const container = document.querySelector('.container');
    ReactDOM.createRoot(container).render(<App />);
  </script>
</body>
</html>
