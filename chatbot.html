<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ChatBot</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
  <link rel="stylesheet" href="./chat.css"/>

</head>
<body>
  <div class="container"></div>
  <button class="theme-button" onClick="toggleTheme()" >Theme</button>
  <script type="text/babel">

    

    function ChatInput({chatMessages,setChatMessages}) {

      const[inputText,setInputText] = React.useState( '');

      function saveInputText(event){
        setInputText(event.target.value);
      }

      function sendMessage(){
        if (!inputText.trim()) return;

        const newChatMessages = [
          ...chatMessages,
          {
              message:inputText,
              sender:'user',
              id :crypto.randomUUID()
            },
          ];
        setChatMessages(newChatMessages);

          const response = Chatbot.getResponse(inputText);

          setChatMessages([
          ...newChatMessages,
          {
              message:response,
              sender:'bot',
              id :crypto.randomUUID()
            },
          ]);


          setInputText('');

      }
      function handleKeyPress(event){
        if(event.key === "Enter"){
          sendMessage();
        }
      }
      return (
        <div class="input-text">
          <input 
            placeholder="Message with chatbot" 
            size="20"
            onChange={saveInputText}
            onKeyDown={handleKeyPress}
            value={inputText}
            class="input"
          />
          <button 
            onClick={sendMessage}
            class = "send-button"
          >Send</button>
        </div>
      );
    }

    function ChatMessage({ message, sender }) {
      return (
        <div class={`message-by-${sender}`} >
          {sender === 'bot' && <img class="bot-im" src="./Bot.webp" width="50" />}
          <div class="text-mes" >{message}</div>
          {sender === 'user' && <img class="profile-im" src="./Profile.webp" />}
        </div>
      );
    }

    function ChatMessages({chatMessages}) {
        return (
          <>
            {chatMessages.map((chatMessage) => {
                return (
                  <ChatMessage 
                    message={chatMessage.message}
                    sender={chatMessage.sender}
                    key={chatMessage.id}
                  />
                );
              })}
          </>
        );

    }

    function App() {
      const [chatMessages, setChatMessages] = React.useState([]);
      
      return (
        <>
          <ChatInput 
            chatMessages = {chatMessages}
            setChatMessages = {setChatMessages}
          />
          <ChatMessages 
            chatMessages = {chatMessages}
          />
        </>
      );
    }

    // Mount React App
    const container = document.querySelector('.container');
    ReactDOM.createRoot(container).render(<App />);
  </script>
</body>
</html>
